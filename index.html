<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lompat Tangga - Freminet</title>
    <style>
        body {
            /* Gaya dasar untuk memastikan canvas ada di tengah */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #333; /* Background di luar canvas */
        }
        canvas {
            display: block;
            margin: 0 auto;
            border: 5px solid #fff; /* Tambahkan bingkai untuk estetika */
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    
    <audio id="backgroundMusic" loop>
        <source src="game_music.mp3" type="audio/mpeg">
        Browser Anda tidak mendukung elemen audio.
    </audio>
    
    <script>
        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");
        
        // --- Setup Audio ---
        var music = document.getElementById("backgroundMusic");

        // Fungsi untuk memulai musik. Dipanggil setelah interaksi user.
        function startMusic() {
            music.volume = 0.5; // Atur volume agar tidak terlalu keras
            music.play().catch(error => {
                // Tangani kasus Autoplay diblokir
                console.log("Autoplay diblokir. Musik akan dimulai setelah interaksi pengguna.");
            });
        }
        
        // Mulai musik segera setelah interaksi pertama (misal, tombol ditekan)
        document.addEventListener('keydown', startMusic, { once: true });
        document.addEventListener('click', startMusic, { once: true });


        // --- Variabel Gambar ---
        var charImg = new Image();
        charImg.src = "Freminet-removebg-preview.png"; // Ganti dengan path gambar Anda
        
        var bgImg = new Image();
        // NAMA FILE BACKGROUND DIUBAH MENJADI .JPG
        bgImg.src = "bg lompat tangga.jpg"; 

        // --- Variabel Game State dan Win Condition ---
        var score = 0;
        var WIN_SCORE = 20; // Target skor untuk menang
        var gameState = "running"; // Bisa "running", "gameOver", "win"

        // --- Player ---
        var player = {
            x: 175,
            y: 500,
            width: 50,
            height: 50,
            vy: 0,
            gravity: 0.5,
            jumpStrength: -10,
            onGround: false
        };

        // --- Platform/Tangga ---
        var platforms = [];
        function initializePlatforms() {
            platforms = [];
            for (var i = 0; i < 8; i++) {
                platforms.push({
                    x: Math.random() * 320,
                    y: i * 75 + 50,
                    width: 80,
                    height: 15
                });
            }
        }
        initializePlatforms(); // Inisialisasi awal

        // --- Kontrol ---
        var keys = {};
        document.addEventListener("keydown", function(e) { 
            keys[e.key] = true; 
            // Tambahkan kontrol untuk restart saat game over/win
            if ((gameState === "gameOver" || gameState === "win") && e.key === "Enter") {
                resetGame();
            }
        });
        document.addEventListener("keyup", function(e) { keys[e.key] = false; });

        // --- Fungsi Reset Game ---
        function resetGame() {
            player.x = 175;
            player.y = 500;
            player.vy = 0;
            score = 0;
            initializePlatforms();
            gameState = "running";
            // Lanjutkan musik jika sebelumnya berhenti
            startMusic();
        }

        // --- Fungsi Draw (Gambar) ---
        function draw() {
            // 1. Gambar Background
            if (bgImg.complete && bgImg.naturalWidth !== 0) {
                // Gambar background jika sudah dimuat
                ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
            } else {
                // Fallback: Gunakan warna solid jika gambar belum atau gagal dimuat
                ctx.fillStyle = "#87CEEB";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // 2. Gambar Platform/Tangga
            ctx.fillStyle = "#78C878";
            platforms.forEach(function(p) {
                ctx.fillRect(p.x, p.y, p.width, p.height);
            });

            // 3. Gambar Player
            ctx.drawImage(charImg, player.x, player.y, player.width, player.height);

            // 4. Gambar Score
            ctx.font = "20px Arial";
            ctx.fillStyle = "#222";
            ctx.fillText("Score: " + score, 10, 30);
            
            // 5. Gambar Status Game (Jika Game Over atau Win)
            if (gameState !== "running") {
                drawGameStateOverlay();
            }
        }
        
        // Fungsi untuk menggambar overlay Game Over/Win
        function drawGameStateOverlay() {
            // Background semi-transparan
            ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.textAlign = "center";
            
            if (gameState === "gameOver") {
                ctx.font = "40px Arial";
                ctx.fillStyle = "#FF4444";
                ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2 - 20);
                
                ctx.font = "20px Arial";
                ctx.fillStyle = "#FFFFFF";
                ctx.fillText("Skor Akhir: " + score, canvas.width / 2, canvas.height / 2 + 20);
                ctx.fillText("Tekan [Enter] untuk Mulai Lagi", canvas.width / 2, canvas.height / 2 + 50);
                music.pause(); // Hentikan musik saat game over
            } else if (gameState === "win") {
                ctx.font = "40px Arial";
                ctx.fillStyle = "#44FF44";
                ctx.fillText("YOU WIN!", canvas.width / 2, canvas.height / 2 - 20);
                
                ctx.font = "20px Arial";
                ctx.fillStyle = "#FFFFFF";
                ctx.fillText("Skor Anda: " + score, canvas.width / 2, canvas.height / 2 + 20);
                ctx.fillText("Tekan [Enter] untuk Mulai Lagi", canvas.width / 2, canvas.height / 2 + 50);
                music.pause(); // Hentikan musik saat menang
            }
            ctx.textAlign = "left"; // Kembalikan ke default
        }


        // --- Fungsi Update (Logika Game) ---
        function update() {
            if (gameState !== "running") return; // Berhenti update jika game berakhir

            // Kontrol kanan kiri
            if (keys["ArrowLeft"]) player.x -= 5;
            if (keys["ArrowRight"]) player.x += 5;

            // Batas layar
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            // Gravity
            player.vy += player.gravity;
            player.y += player.vy;

            // Cek collision dengan platform, lompat!
            player.onGround = false;
            platforms.forEach(function(p) {
                if (player.vy > 0 &&
                    player.x + player.width > p.x &&
                    player.x < p.x + p.width &&
                    player.y + player.height > p.y &&
                    player.y + player.height < p.y + p.height + player.vy) {
                    player.vy = player.jumpStrength;
                    player.onGround = true;
                    score += 1;
                    
                    // Cek Win Condition
                    if (score >= WIN_SCORE) {
                        gameState = "win";
                    }
                }
            });

            // Platform naik jika player naik
            if (player.y < 250) {
                player.y += 5;
                platforms.forEach(function(p) {
                    p.y += 5;
                    // Jika platform keluar dari bawah, respawn di atas
                    if (p.y > canvas.height) {
                        p.y = Math.random() * -40;
                        p.x = Math.random() * 320;
                    }
                });
            }

            // Jika jatuh ke bawah, Game Over
            if (player.y > canvas.height) {
                gameState = "gameOver";
            }
        }

        // --- Loop Game ---
        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        // Mulai setelah semua gambar dimuat (termasuk karakter dan background)
        var imagesLoaded = 0;
        var totalImages = 2; // charImg dan bgImg

        function imageLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                loop();
            }
        }

        charImg.onload = imageLoaded;
        bgImg.onload = imageLoaded;
        
        // PENTING: Jika gambar gagal dimuat (misalnya, file tidak ada), pastikan game tetap berjalan
        charImg.onerror = function() { console.error("Gagal memuat gambar karakter."); imageLoaded(); };
        bgImg.onerror = function() { console.warn("Gagal memuat gambar background. Menggunakan warna fallback."); imageLoaded(); };
        
    </script>
</body>
</html>
